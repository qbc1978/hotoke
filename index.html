<script>
  const API_BASE = "https://script.google.com/macros/s/AKfycbyS8kgXYgJPwJuo6MFSAE9b4615ylFQpqM8fS8otfP3gZxICw8To6C_h5kG-sJN_q2N/exec";

  const $ = s => document.querySelector(s);
  const loading = $('#loading'), view = $('#view'), err = $('#error');
  const img = $('#img'), title = $('#title'), desc = $('#desc'), id = $('#id');

  async function load() {
    try {
      const url = `${API_BASE}?_=${Date.now()}`; // キャッシュ避け
      const res = await fetch(url, {
        method: 'GET',
        headers: { 'Accept': 'application/json' },
        // mode: 'cors' はデフォルトでOK
      });

      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      let data;
      try {
        data = await res.json();
      } catch (e) {
        throw new Error('JSONのパースに失敗（たぶんログイン画面やHTMLが返ってる）');
      }

      if (!data.ok) throw new Error(data.error || 'unknown');

      img.src = data.imageUrl;
      title.textContent = data.name || '';
      desc.textContent = data.result || '';
      id.textContent = data.id ? `No. ${data.id}` : '';

      loading.style.display = 'none';
      err.style.display = 'none';
      view.style.display = 'grid';
    } catch (e) {
      loading.style.display = 'none';
      err.textContent = '取得に失敗しました: ' + e.message;
      err.style.display = 'block';
      console.error(e);
    }
  }
  load();
</script>
